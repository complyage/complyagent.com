package publish

//||------------------------------------------------------------------------------------------------||
//|| Import
//||------------------------------------------------------------------------------------------------||

import (
	"encoding/json"
	"fmt"

	"github.com/ralphferrara/aria/app"
)

//||------------------------------------------------------------------------------------------------||
//|| PublishAgentVerification
//||------------------------------------------------------------------------------------------------||

func PublishAgentVerification(agentRequest AgentVerification) error {

	//||------------------------------------------------------------------------------------------------||
	//|| Create the JSON
	//||------------------------------------------------------------------------------------------------||

	body, err := json.Marshal(agentRequest)
	if err != nil {
		return err // optionally wrap with your error codes
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Fetch Aria RabbitMQ Instance
	//||------------------------------------------------------------------------------------------------||

	rabbit := app.QueueRabbit["agent"]
	if rabbit == nil {
		return fmt.Errorf("RabbitMQ instance 'agent' not found")
	}

	//||------------------------------------------------------------------------------------------------||
	//|| Get Channel
	//||------------------------------------------------------------------------------------------------||

	var channelName string
	switch agentRequest.Level {
	case 1:
		channelName = "AgentLevelOne"
	case 2:
		channelName = "AgentLevelTwo"
	}

	//||------------------------------------------------------------------------------------------------||
	//|| publish
	//||------------------------------------------------------------------------------------------------||

	return rabbit.Publish(channelName, body)
}
